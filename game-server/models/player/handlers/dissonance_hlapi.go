package handlers

import (
	"game-server/models"
	networkModels "game-server/models/game/enums/network"
	"game-server/models/game/request"
	"game-server/models/game/response"
	"game-server/network"
)

var receivedHLAPI = false

func HandlePacketHLAPIRequest(packet *request.PacketHLAPIRequest, g *network.NetworkManager, profileID string) {
	if !receivedHLAPI {
		receivedHLAPI = true

		start := []byte{0x0F, 0x8B, 0xC7, 0x05, 0x4D, 0x02, 0xDE, 0xF1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2F, 0x00, 0xD1, 0x47, 0x2E, 0x8B, 0xC7, 0x01, 0x4D, 0x02, 0xDE, 0xF1, 0x00, 0x19}
		end := []byte{0x00, 0x00, 0x01, 0x00, 0x00, 0x07, 0x80, 0x00, 0x00, 0xBB, 0x80, 0x00, 0x00, 0x01, 0x00, 0x0C, 0x00, 0x00, 0x01, 0x00, 0x0C, 0x00, 0x01, 0x2F, 0x00, 0x03, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x80, 0x3F, 0x02, 0x00, 0x0F, 0x00, 0x01, 0x01}
		resp := &models.DataPacket{
			GamePacketType: uint16(networkModels.HLAPI),
			GamePacket: &response.PacketHLAPIResponse{
				Data: append(start, append([]byte(profileID), end...)...),
			},
		}
		g.SendQueue <- &models.NetworkMessage{
			Channel: models.NetworkChannelReliable,
			Type:    models.NetworkMessageTypeData,
			Buffer:  resp.Write(),
		}
	}
	receivedHLAPI = true
}
